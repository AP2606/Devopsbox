server {
    listen 80;
    server_name localhost;
    
    # Adding charset definition for safer header response
    charset utf-8;

    # Set the root directory and default index file
    root /usr/share/nginx/html;
    index index.html;
    
    # --- 1. Explicitly Handle JavaScript Assets via Regex Match ---
    # This block intercepts ALL requests ending in .js (like /assets/index-BmBpXLFj.js).
    # This is the final, most robust fix for the MIME type mismatch.
    location ~* \.js$ {
        # Force the correct MIME type for module scripts
        add_header Content-Type application/javascript;
        
        # Try to serve the file directly. If not found, return 404. 
        # Crucially, this prevents the request from falling back to index.html.
        try_files $uri =404; 

        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }
    
    # --- 2. Explicitly Handle CSS Assets via Regex Match ---
    location ~* \.css$ {
        add_header Content-Type text/css;
        try_files $uri =404;
        
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    # --- 3. Handle Client-Side Routes (SPA Fallback) ---
    # This location handles all non-static requests (like /challenges).
    location / {
        # If the file doesn't exist, fall back to index.html for React Router to handle.
        try_files $uri $uri/ /index.html;
    }
}

